{"ast":null,"code":"import React,{useContext,useEffect}from'react';import{Card,Table,Button,Alert}from'react-bootstrap';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faHistory,faEye,faTrash,faCircle}from'@fortawesome/free-solid-svg-icons';import{UserProfileContext}from'../context/UserProfileContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const WatchHistory=()=>{const{watchHistory,loading,error,loadUserProfile,clearWatchHistory,addToWatchHistory}=useContext(UserProfileContext);useEffect(()=>{loadUserProfile();},[loadUserProfile]);const handleClearHistory=async()=>{if(window.confirm('Are you sure you want to clear your watch history?')){await clearWatchHistory();}};const handleWatchChannel=async channel=>{// Add to watch history\nawait addToWatchHistory(channel._id);// Open channel URL in new tab\nwindow.open(channel.url,'_blank');};const formatDuration=seconds=>{if(!seconds)return'0s';if(seconds<60){return\"\".concat(seconds,\"s\");}else if(seconds<3600){const minutes=Math.floor(seconds/60);return\"\".concat(minutes,\"m\");}else{const hours=Math.floor(seconds/3600);const minutes=Math.floor(seconds%3600/60);return\"\".concat(hours,\"h \").concat(minutes,\"m\");}};if(loading){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Card.Body,{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner-border text-primary\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Loading...\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2\",children:\"Loading watch history...\"})]})});}if(error){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:error})})});}return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"me-2 text-info\"}),\"Watch History\"]}),watchHistory.length>0&&/*#__PURE__*/_jsxs(Button,{variant:\"outline-danger\",size:\"sm\",onClick:handleClearHistory,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTrash,className:\"me-1\"}),\"Clear History\"]})]}),/*#__PURE__*/_jsx(Card.Body,{children:watchHistory.length===0?/*#__PURE__*/_jsx(Alert,{variant:\"info\",children:\"Your watch history is empty.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(Table,{striped:true,bordered:true,hover:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",style:{width:'60px'},children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Channel Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Provider\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"Watched On\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"Duration\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:watchHistory.map(item=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCircle,className:item.channel.isLive?'channel-status-live':'channel-status-down',size:\"sm\"})}),/*#__PURE__*/_jsx(\"td\",{children:item.channel.name}),/*#__PURE__*/_jsx(\"td\",{children:item.channel.provider}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:new Date(item.watchedAt).toLocaleString()}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:formatDuration(item.duration)}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",onClick:()=>handleWatchChannel(item.channel),title:\"Watch Channel\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faEye})})})]},item._id))})]})})})]});};export default WatchHistory;","map":{"version":3,"names":["React","useContext","useEffect","Card","Table","Button","Alert","FontAwesomeIcon","faHistory","faEye","faTrash","faCircle","UserProfileContext","jsx","_jsx","jsxs","_jsxs","WatchHistory","watchHistory","loading","error","loadUserProfile","clearWatchHistory","addToWatchHistory","handleClearHistory","window","confirm","handleWatchChannel","channel","_id","open","url","formatDuration","seconds","concat","minutes","Math","floor","hours","children","Body","className","role","variant","Header","icon","length","size","onClick","striped","bordered","hover","style","width","map","item","isLive","name","provider","Date","watchedAt","toLocaleString","duration","title"],"sources":["/var/www/iptv-manager/frontend/src/components/WatchHistory.js"],"sourcesContent":["import React, { useContext, useEffect } from 'react';\r\nimport { Card, Table, Button, Alert } from 'react-bootstrap';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faHistory, faEye, faTrash, faCircle } from '@fortawesome/free-solid-svg-icons';\r\nimport { UserProfileContext } from '../context/UserProfileContext';\r\n\r\nconst WatchHistory = () => {\r\n  const { watchHistory, loading, error, loadUserProfile, clearWatchHistory, addToWatchHistory } = useContext(UserProfileContext);\r\n  \r\n  useEffect(() => {\r\n    loadUserProfile();\r\n  }, [loadUserProfile]);\r\n  \r\n  const handleClearHistory = async () => {\r\n    if (window.confirm('Are you sure you want to clear your watch history?')) {\r\n      await clearWatchHistory();\r\n    }\r\n  };\r\n  \r\n  const handleWatchChannel = async (channel) => {\r\n    // Add to watch history\r\n    await addToWatchHistory(channel._id);\r\n    \r\n    // Open channel URL in new tab\r\n    window.open(channel.url, '_blank');\r\n  };\r\n  \r\n  const formatDuration = (seconds) => {\r\n    if (!seconds) return '0s';\r\n    \r\n    if (seconds < 60) {\r\n      return `${seconds}s`;\r\n    } else if (seconds < 3600) {\r\n      const minutes = Math.floor(seconds / 60);\r\n      return `${minutes}m`;\r\n    } else {\r\n      const hours = Math.floor(seconds / 3600);\r\n      const minutes = Math.floor((seconds % 3600) / 60);\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n  };\r\n  \r\n  if (loading) {\r\n    return (\r\n      <Card>\r\n        <Card.Body className=\"text-center\">\r\n          <div className=\"spinner-border text-primary\" role=\"status\">\r\n            <span className=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n          <p className=\"mt-2\">Loading watch history...</p>\r\n        </Card.Body>\r\n      </Card>\r\n    );\r\n  }\r\n  \r\n  if (error) {\r\n    return (\r\n      <Card>\r\n        <Card.Body>\r\n          <Alert variant=\"danger\">{error}</Alert>\r\n        </Card.Body>\r\n      </Card>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <Card>\r\n      <Card.Header className=\"d-flex justify-content-between align-items-center\">\r\n        <h5 className=\"mb-0\">\r\n          <FontAwesomeIcon icon={faHistory} className=\"me-2 text-info\" />\r\n          Watch History\r\n        </h5>\r\n        {watchHistory.length > 0 && (\r\n          <Button\r\n            variant=\"outline-danger\"\r\n            size=\"sm\"\r\n            onClick={handleClearHistory}\r\n          >\r\n            <FontAwesomeIcon icon={faTrash} className=\"me-1\" />\r\n            Clear History\r\n          </Button>\r\n        )}\r\n      </Card.Header>\r\n      <Card.Body>\r\n        {watchHistory.length === 0 ? (\r\n          <Alert variant=\"info\">\r\n            Your watch history is empty.\r\n          </Alert>\r\n        ) : (\r\n          <div className=\"table-responsive\">\r\n            <Table striped bordered hover>\r\n              <thead>\r\n                <tr>\r\n                  <th className=\"text-center\" style={{ width: '60px' }}>Status</th>\r\n                  <th>Channel Name</th>\r\n                  <th>Provider</th>\r\n                  <th className=\"text-center\">Watched On</th>\r\n                  <th className=\"text-center\">Duration</th>\r\n                  <th className=\"text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {watchHistory.map((item) => (\r\n                  <tr key={item._id}>\r\n                    <td className=\"text-center\">\r\n                      <FontAwesomeIcon\r\n                        icon={faCircle}\r\n                        className={item.channel.isLive ? 'channel-status-live' : 'channel-status-down'}\r\n                        size=\"sm\"\r\n                      />\r\n                    </td>\r\n                    <td>{item.channel.name}</td>\r\n                    <td>{item.channel.provider}</td>\r\n                    <td className=\"text-center\">\r\n                      {new Date(item.watchedAt).toLocaleString()}\r\n                    </td>\r\n                    <td className=\"text-center\">\r\n                      {formatDuration(item.duration)}\r\n                    </td>\r\n                    <td className=\"text-center\">\r\n                      <Button\r\n                        variant=\"outline-primary\"\r\n                        size=\"sm\"\r\n                        onClick={() => handleWatchChannel(item.channel)}\r\n                        title=\"Watch Channel\"\r\n                      >\r\n                        <FontAwesomeIcon icon={faEye} />\r\n                      </Button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </Table>\r\n          </div>\r\n        )}\r\n      </Card.Body>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default WatchHistory;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}